---
title: "The Country-level Impact of Educational Features on the Rate of Entrepreneurship - Data Gathering and Analysis"
author: "Samuel Dundon and Thierry Racaud"
date: "November 14, 2014"
output: html_document
---

```{r echo =FALSE, cache=TRUE, include=FALSE, results='asis'}

# Set working directory
setwd('~/Assign2Education/')

# Library Repmis, Tidy, Reshape2, and plyr packages
library(repmis)
library(tidyr)
library(reshape2)
library(plyr)
library(WDI)
library(stargazer)
library(Zelig)

# Load citation package
pkgs <- c('repmis', 'tidyr', 'reshape2', 'plyr', 'WDI')
repmis::LoadandCite(pkgs, file= 'DataRpackageCitations.bib')

#### Import data from GEM Survey ####

# Import GEM fear of failure data
FearFail <- repmis::source_data("https://raw.githubusercontent.com/SamDund/Assign2Education/master/GEMData/GEM_FearFail.csv", header = TRUE, cache = FALSE) 

# Import GEM estblished entrepreneurship - current owner data
CurrentOwner <- repmis::source_data("https://raw.githubusercontent.com/SamDund/Assign2Education/master/GEMData/GEM_CurrentOwner.csv", header = TRUE, cache = FALSE) 

# Import GEM entrepreneurial intention data
EntreIntention <- repmis::source_data("https://raw.githubusercontent.com/SamDund/Assign2Education/master/GEMData/GEM_EntreIntention.csv", header = TRUE, cache = FALSE) 

# Import GEM nascent entrepreneur data
NascentEntre <- repmis::source_data("https://raw.githubusercontent.com/SamDund/Assign2Education/master/GEMData/GEM_NascentEntre.csv", header = TRUE, cache = FALSE) 

# Import GEM perceived capabilities data
PerceivedCapabilities <- repmis::source_data("https://raw.githubusercontent.com/SamDund/Assign2Education/master/GEMData/GEM_PerceivedCapabilities.csv", header = TRUE, cache = FALSE) 

# Import GEM perceived opportunities data as a proxy for potential control variables
PerceivedOpportunities <- repmis::source_data("https://raw.githubusercontent.com/SamDund/Assign2Education/master/GEMData/PerceivedOpportunities.csv", header = TRUE, cache = FALSE)

#### Clean data using tidy ####

### Clean FearFail ###
# Percentage of 18-64 population with positive perceived opportunities who indicate that fear of failure would prevent them from setting up a business.

# Remove X's in FearFail year columns
names(FearFail) <- gsub("X", "", names(FearFail))


# Change years from columns to rows and create CFearFail
CFearFail <- melt(data = FearFail,
                  id.vars = c("Country"),
                  measure.vars = c("2001", "2002", "2003", "2004", "2005", "2006",
                                   "2007", "2008", "2009", "2010", "2011", "2012",
                                   "2013"))

# Rename columns
CFearFail <- plyr::rename(x = CFearFail, 
                                      replace = c("variable" = "Year",
                                                  "value" = "PercentFear"))

### Clean CurrentOwner ###
# Percentage of 18-64 population who are currently owner-manager of an established business, i.e., owning and managing a running business that has paid sallaries, wages, or any other payments to the owners for more than 42 months

# Remove X's in CurrentOwner year columns
names(CurrentOwner) <- gsub("X", "", names(CurrentOwner))


# Change years from columns to rows and create CCurrentOwner
CCurrentOwner <- melt(data = CurrentOwner,
                  id.vars = c("Country"),
                  measure.vars = c("2001", "2002", "2003", "2004", "2005", "2006",
                                   "2007", "2008", "2009", "2010", "2011", "2012",
                                   "2013"))

# Rename columns
CCurrentOwner <- plyr::rename(x = CCurrentOwner, 
                                      replace = c("variable" = "Year",
                                                  "value" = "PercentOwner"))

### Clean EntreIntention ###
# Percentage of 18-64 population (individuals involved in any stage of entrepenerurial activity excluded) who intend to start a business within three years.

# Remove X's in EntreIntention year columns
names(EntreIntention) <- gsub("X", "", names(EntreIntention))


# Change years from columns to rows and create CEntreIntention (No 2001 data available)
CEntreIntention <- melt(data = EntreIntention,
                  id.vars = c("Country"),
                  measure.vars = c("2002", "2003", "2004", "2005", "2006",
                                   "2007", "2008", "2009", "2010", "2011", "2012",
                                   "2013"))

# Rename columns
CEntreIntention <- plyr::rename(x = CEntreIntention, 
                                      replace = c("variable" = "Year",
                                                  "value" = "PercentIntention"))

### Clean NascentEntre ###
# Percentage of 18-64 population who are currently a nascent entrepreneur, i.e., actively involved in setting up a business they will own or co-own; this business has not paid salaries, wages, or any other payments to the owners for more than three months.

# Remove X's in NascentEntre year columns
names(NascentEntre) <- gsub("X", "", names(NascentEntre))


# Change years from columns to rows and create CNascentEntre
CNascentEntre <- melt(data = NascentEntre,
                  id.vars = c("Country"),
                  measure.vars = c("2001", "2002", "2003", "2004", "2005", "2006",
                                   "2007", "2008", "2009", "2010", "2011", "2012",
                                   "2013"))

# Rename columns
CNascentEntre <- plyr::rename(x = CNascentEntre, 
                                      replace = c("variable" = "Year",
                                                  "value" = "PercentNascent"))

### Clean PerceivedCapabilities ###
# Percentage of 18-64 population who believe to have the required skills and knowledge to start a business

# Remove X's in PerceivedCapabilities year columns
names(PerceivedCapabilities) <- gsub("X", "", names(PerceivedCapabilities))

# Change years from columns to rows and create CPreceivedCapabilities
CPerceivedCapabilities<- melt(data = PerceivedCapabilities,
                  id.vars = c("Country"),
                  measure.vars = c("2001", "2002", "2003", "2004", "2005", "2006",
                                   "2007", "2008", "2009", "2010", "2011", "2012",
                                   "2013"))

# Rename columns
CPerceivedCapabilities <- plyr::rename(x = CPerceivedCapabilities, 
                                      replace = c("variable" = "Year",
                                                  "value" = "PercentPerceived"))

### Clean PerceivedOpportunities ###
# Percentage of 18-64 population who see good opportunities to start a firm in the area where they live

# Remove X's in PerceivedOpportunities year columns
names(PerceivedOpportunities) <- gsub("X", "", names(PerceivedOpportunities))

# Change years from columns to rows and create CPreceivedOpportunities
CPerceivedOpportunities<- melt(data = PerceivedOpportunities,
                  id.vars = c("Country"),
                  measure.vars = c("2001", "2002", "2003", "2004", "2005", "2006",
                                   "2007", "2008", "2009", "2010", "2011", "2012",
                                   "2013"))

# Rename columns
CPerceivedOpportunities <- plyr::rename(x = CPerceivedOpportunities, 
                                      replace = c("variable" = "Year",
                                                  "value" = "PercentOpportunities"))

#### Merge the data ####
MergedGEM <- merge(CCurrentOwner, CEntreIntention,
                   union("Country", "Year"),
                   all = TRUE)

MergedGem2 <- merge(CFearFail, CNascentEntre,
                   union("Country", "Year"),
                   all = TRUE) 

MergedGem3 <- merge(CPerceivedCapabilities, MergedGEM,
                   union("Country", "Year"),
                   all = TRUE) 

MergedGem4 <- merge(MergedGem2, MergedGem3,
                   union("Country", "Year"),
                   all = TRUE) 

FinalGEM <- merge(MergedGem4, CPerceivedOpportunities,
                   union("Country", "Year"),
                   all = TRUE)

# Convert percent columns from character to numeric
FinalGEM[,"PercentPerceived"] <- as.numeric(FinalGEM[,"PercentPerceived"])
FinalGEM[,"PercentFear"] <- as.numeric(FinalGEM[,"PercentFear"])
FinalGEM[,"PercentNascent"] <- as.numeric(FinalGEM[,"PercentNascent"])
FinalGEM[,"PercentOwner"] <- as.numeric(FinalGEM[,"PercentOwner"])
FinalGEM[,"PercentIntention"] <- as.numeric(FinalGEM[,"PercentIntention"])
FinalGEM[,"PercentOpportunities"] <- as.numeric(FinalGEM[,"PercentOpportunities"])


#### Import WDI Annual GDP Growth Data ####
GDPGrowth = WDI(indicator='NY.GDP.MKTP.KD.ZG', country=c('MX','CA','US','FR','AU','AT','BE',
                                                         'CL','CZ','DK','EE','FI','DE','HU', 
                                                         'IS','IE','IL','IT','JP','KR','LU',
                                                         'NL','NZ','NO','PL','PT','SK','SI',
                                                         'ES','SE','CH','TR','GB','US','GR'), 
                start=2001, end=2013)
# Rename columns
GDPGrowth <- plyr::rename(x = GDPGrowth, 
                                      replace = c("year" = "Year",
                                                  "NY.GDP.MKTP.KD.ZG" = "AnnualGDPGrowth",
                                                  "country" = "Country"))


# Recode country == "United States" to "United States of America" and Korea, Rep. to Korea (South)
GDPGrowth$Country[GDPGrowth$Country == "United States"] <- "United States of America"

# Recode country == "Korea, Rep."" to "Korea (South)"
GDPGrowth$Country[GDPGrowth$Country == "Korea, Rep."] <- "Korea (South)"

# Remove iso2c data to ease merge with FinalMerge data
GDPGrowth$iso2c <- NULL

# Merge GDPGrowth and FinalGEM
CompleteDataset <- merge(FinalGEM, GDPGrowth,
                   union("Country", "Year"),
                   all = TRUE) 

# Remove unncessary data from environment
remove(CCurrentOwner, CEntreIntention, CFearFail, CNascentEntre, CPerceivedCapabilities, CPerceivedOpportunities, CurrentOwner, EntreIntention, FearFail, MergedGEM, MergedGem2, MergedGem3, MergedGem4, PerceivedCapabilities, PerceivedOpportunities, NascentEntre)

# Check data to confirm change
summary(CompleteDataset)

# Run a linear regression
R1 <- lm(PercentIntention ~ PercentPerceived + PercentFear*PercentOpportunities + AnnualGDPGrowth, data = CompleteDataset)

# Obtain summary statistics of R1
summary(R1)

# Calculate confidence intervals of R1
confint(R1)

# Run a linear regression of R2
R2 <- lm(PercentNascent ~ PercentPerceived + PercentFear*PercentOpportunities + AnnualGDPGrowth, data = CompleteDataset)

# Obtain summary statistics of R2
summary(R2)

# Calculate confidence intervals of R2
confint(R2)

# Run a linear regression of R3
R3 <- lm(PercentOwner ~ PercentPerceived + PercentFear*PercentOpportunities + AnnualGDPGrowth, data = CompleteDataset)
 
# Obtain summary statistics of R3
summary(R3)

# Calculate confidence intervals of R3
confint(R3)

# Plot graph
car::scatterplotMatrix(CompleteDataset)
```                           

```{r echo = FALSE, cache=TRUE, include=TRUE, results='asis'} 
# Create regression output table
labels <- c('Percent Perceived', 'Percent Fear',
            'Annual GDP Growth', 'Percent Opportunities', 'Percent Fear x Percent Opportunities','(Intercept)')

stargazer::stargazer(R1, R2, R3, covariate.labels = labels, 
                     title = 'Linear Regression Estimates', digits = 2, type = 'html')

```

```{r echo = FALSE, cache=TRUE, include=TRUE, results='asis'}
library(Zelig)


Z1 <- zelig(PercentIntention ~ PercentPerceived + PercentFear*PercentOpportunities + AnnualGDPGrowth, cite = FALSE,
            data = CompleteDataset, model = 'ls', param = function(z.out))

z5 <- zls$new()

summary(Z1)

Z1$sim()

sim(setz1)

```

*Introduction to Collaborative Social Science Data Analysis*

### Research Question

To what extent do the behavioural characteristics of the education system - individualistic, group-oriented, self-esteem reinforcing - affect the rate of entrepreneurship in OECD countries?


### Estimation Strategy

### Causal Chain  

Stronger culture of positive reinforcement ---> higher degree of individual self-esteem ---> higher probability an individual will become an entrepreneur ---> higher rate of entrepreneurship at a country-level.

### Data

To find out, we need to gather quantitative data about entrepreneurship on the one hand, and some measures of these behavioural characteristics on the other hand.

Regarding entrepreneurship, we intend to look into three dimensions. We intend to look at established entrepreneurship in the country, whether it is successful or not, nascent entrepreneurship (less than three months), again whether it is successful or not, and entrepreneurial intention. We may well observe different effects, studying them successively.

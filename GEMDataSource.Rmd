---
title: "DataGatheringandAnalysis"
author: "Sam"
date: "November 10, 2014"
output: html_document
---

```{r echo =FALSE, cache=TRUE, include=FALSE}
# Set working directory
setwd('~/Assign2Education/')

# Library Repmis, Tidy, Reshape2, and plyr packages
library(repmis)
library(tidyr)
library(reshape2)
library(plyr)
library(WDI)

# Load citation package
pkgs <- c('repmis', 'tidyr', 'reshape2', 'plyr', 'WDI')
repmis::LoadandCite(pkgs, file= 'DataRpackageCitations.bib')

#### Import data from GEM Survey ####

# Import fear of failure data
FearFail <- repmis::source_data("https://raw.githubusercontent.com/SamDund/Assign2Education/master/GEMData/GEM_FearFail.csv", header = TRUE, cache = FALSE) 

# Import current owner data
CurrentOwner <- repmis::source_data("https://raw.githubusercontent.com/SamDund/Assign2Education/master/GEMData/GEM_CurrentOwner.csv", header = TRUE, cache = FALSE) 

# Import entrepreneurial intention data
EntreIntention <- repmis::source_data("https://raw.githubusercontent.com/SamDund/Assign2Education/master/GEMData/GEM_EntreIntention.csv", header = TRUE, cache = FALSE) 

# Import nascent entrepreneur data
NascentEntre <- repmis::source_data("https://raw.githubusercontent.com/SamDund/Assign2Education/master/GEMData/GEM_NascentEntre.csv", header = TRUE, cache = FALSE) 

# Import perceived capabilities data
PerceivedCapabilities <- repmis::source_data("https://raw.githubusercontent.com/SamDund/Assign2Education/master/GEMData/GEM_PerceivedCapabilities.csv", header = TRUE, cache = FALSE) 

#### Clean data using tidy ####

### Clean FearFail ###
# Percentage of 18-64 population with positive perceived opportunities who indicate that fear of failure would prevent them from seeting up a business.

# Remove X's in FearFail year columns
names(FearFail) <- gsub("X", "", names(FearFail))


# Change years from columns to rows and create CFearFail
CFearFail <- melt(data = FearFail,
                  id.vars = c("Country"),
                  measure.vars = c("2001", "2002", "2003", "2004", "2005", "2006",
                                   "2007", "2008", "2009", "2010", "2011", "2012",
                                   "2013"))

# Rename columns
CFearFail <- plyr::rename(x = CFearFail, 
                                      replace = c("variable" = "Year",
                                                  "value" = "PercentFear"))

### Clean CurrentOwner ###
# Percentage of 18-64 population who are currently owner-manager of an established business, i.e., owning and managing a running business that has paid sallaries, wages, or any other payments to the owners for more than 42 months

# Remove X's in CurrentOwner year columns
names(CurrentOwner) <- gsub("X", "", names(CurrentOwner))


# Change years from columns to rows and create CCurrentOwner
CCurrentOwner <- melt(data = CurrentOwner,
                  id.vars = c("Country"),
                  measure.vars = c("2001", "2002", "2003", "2004", "2005", "2006",
                                   "2007", "2008", "2009", "2010", "2011", "2012",
                                   "2013"))

# Rename columns
CCurrentOwner <- plyr::rename(x = CCurrentOwner, 
                                      replace = c("variable" = "Year",
                                                  "value" = "PercentOwner"))

### Clean EntreIntention ###
# Percentage of 18-64 population (individuals involved in any stage of entrepenerurial activity excluded) who intend to start a business within three years.

# Remove X's in EntreIntention year columns
names(EntreIntention) <- gsub("X", "", names(EntreIntention))


# Change years from columns to rows and create CEntreIntention (No 2001 data available)
CEntreIntention <- melt(data = EntreIntention,
                  id.vars = c("Country"),
                  measure.vars = c("2002", "2003", "2004", "2005", "2006",
                                   "2007", "2008", "2009", "2010", "2011", "2012",
                                   "2013"))

# Rename columns
CEntreIntention <- plyr::rename(x = CEntreIntention, 
                                      replace = c("variable" = "Year",
                                                  "value" = "PercentIntention"))

### Clean NascentEntre ###
# Remove X's in NascentEntre year columns
names(NascentEntre) <- gsub("X", "", names(NascentEntre))


# Change years from columns to rows and create CNascentEntre
CNascentEntre <- melt(data = NascentEntre,
                  id.vars = c("Country"),
                  measure.vars = c("2001", "2002", "2003", "2004", "2005", "2006",
                                   "2007", "2008", "2009", "2010", "2011", "2012",
                                   "2013"))

# Rename columns
CNascentEntre <- plyr::rename(x = CNascentEntre, 
                                      replace = c("variable" = "Year",
                                                  "value" = "PercentNascent"))

### Clean PerceivedCapabilities ###
# Percentage of 18-64 population who believe to have the required skills and knowledge to start a business

# Remove X's in PerceivedCapabilities year columns
names(PerceivedCapabilities) <- gsub("X", "", names(PerceivedCapabilities))

# Change years from columns to rows and create CPreceivedCapabilities
CPerceivedCapabilities<- melt(data = PerceivedCapabilities,
                  id.vars = c("Country"),
                  measure.vars = c("2001", "2002", "2003", "2004", "2005", "2006",
                                   "2007", "2008", "2009", "2010", "2011", "2012",
                                   "2013"))

# Rename columns
CPerceivedCapabilities <- plyr::rename(x = CPerceivedCapabilities, 
                                      replace = c("variable" = "Year",
                                                  "value" = "PercentPerceived"))

#### Merge the data ####
MergedGEM <- merge(CCurrentOwner, CEntreIntention,
                   union("Country", "Year"),
                   all = TRUE)

MergedGem2 <- merge(CFearFail, CNascentEntre,
                   union("Country", "Year"),
                   all = TRUE) 

MergedGem3 <- merge(CPerceivedCapabilities, MergedGEM,
                   union("Country", "Year"),
                   all = TRUE) 

FinalMerge <- merge(MergedGem2, MergedGem3,
                   union("Country", "Year"),
                   all = TRUE) 

# Convert percent columns from character to numeric
FinalMerge[,"PercentPerceived"] <- as.numeric(FinalMerge[,"PercentPerceived"])
FinalMerge[,"PercentFear"] <- as.numeric(FinalMerge[,"PercentFear"])
FinalMerge[,"PercentNascent"] <- as.numeric(FinalMerge[,"PercentNascent"])
FinalMerge[,"PercentOwner"] <- as.numeric(FinalMerge[,"PercentOwner"])
FinalMerge[,"PercentIntention"] <- as.numeric(FinalMerge[,"PercentIntention"])

# Check data to confirm change
summary(FinalMerge)

# Run a linear regression
R1 <- lm(PercentIntention ~ PercentPerceived + PercentFear, data = FinalMerge)
summary(R1)

# Calculate confidence intervals
confint(R1)

# Run a linear regression
R2 <- lm(PercentNascent ~ PercentPerceived + PercentFear, data = FinalMerge)
summary(R2)

# Calculate confidence intervals
confint(R2)

# Run a linear regression
R3 <- lm(PercentOwner ~ PercentPerceived + PercentFear, data = FinalMerge)
summary(R3)

# Calculate confidence intervals
confint(R3)

# Plot graph
car::scatterplotMatrix(FinalMerge)


#### Import WDI Annual GDP Growth Data ####
WDIsearch('gdp')
GDPGrowth = WDI(indicator='NY.GDP.MKTP.KD.ZG', country=c('MX','CA','US','FR','AU','AT','BE',
                                                         'CL','CZ','DK','EE','FI','DE','HU', 
                                                         'IS','IE','IL','IT','JP','KR','LU',
                                                         'NL','NZ','NO','PL','PT','SK','SI',
                                                         'ES','SE','CH','TR','GB','US','GR'), 
                start=2001, end=2013)
# Rename columns
GDPGrowth <- plyr::rename(x = GDPGrowth, 
                                      replace = c("year" = "Year",
                                                  "NY.GDP.MKTP.KD.ZG" = "AnnualGDPGrowth",
                                                  "country" = "Country"))


# Recode country == "United States" to "United States of America" and Korea, Rep. to Korea (South)
GDPGrowth$Country[GDPGrowth$Country == "United States"] <- "United States of America"

# Recode country == "Korea, Rep."" to "Korea (South)"
GDPGrowth$Country[GDPGrowth$Country == "Korea, Rep."] <- "Korea (South)"

# Remove iso2c data to ease merge with FinalMerge data
GDPGrowth$iso2c <- NULL

# Merge GDPGrowth and FinalMerge
CompeteDataset <- merge(FinalMerge, GDPGrowth,
                   union("Country", "Year"),
                   all = TRUE) 

```
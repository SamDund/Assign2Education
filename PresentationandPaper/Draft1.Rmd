---
title: "Draft1"
author: "Sam"
date: "December 11, 2014"
output: pdf_document
---

```{r echo = FALSE, cache= FALSE, include= FALSE, results= 'asis'}

# Set working directory
setwd('~/Assign2Education/PresentationandPaper')

# Library required packages
library(ggvis)
library(devtools)
library(googleVis)
library(countrycode)
library(repmis)
library(reshape2)
library(shiny)
library(httpuv)
library(ggplot2)

# Create a vector of packages used
pkgs <- c('repmis', 'ggvis', 'devtools', 'googleVis', 'countrycode', 'reshape2', 'shiny', 'httpuv', 'Zelig',
          'stargazer', 'Amelia', 'ggplot2')

# Create citations txt file
repmis::LoadandCite(pkgs, file= 'RpackageCitations.bib')

# Import WayofTeaching data
wot <- repmis::source_data("https://raw.githubusercontent.com/SamDund/Assign2Education/master/GEMData/WayofTeaching", header = TRUE, cache = FALSE, na.strings = "NA")


```

**Quantitative Analysis of the Impact of Education on Entrepreneurship**     


*Data Sources*  


To complete a quantitative analysis of the impact of educational factors -- specifically the encouragement of creatitivity, self-sufficiency, and personal initiative  -- on the country-level rate of entrepreneurship, we have drawn on publicly available data from the Global Entrepreneurship Monitor (GEM) National Expert Survey (NES) and Adult Population Survey (APS).  


The Global Entrepreneurship Monitor project is an annual assessment of the entrepreneurial activity, aspirations, and attitudes of individuals across a wide range of countries.  The countries covered have grown from a low of ten to covering 75% of world population and 89% of world GDP by 2013.  The 2001-2010 multi-year APS data base, for example, contains over 1.3 million observations of a total of 85 countries.  This data is often cited in academic research, including reports by the Organisation for Economic Co-operation and Development.    


The NES is structured around nine entrepreneurial framework contitions evaluated by thirty-six experts in each surveyed country.  These nine entrepreneurial framework conditions are included below (a minimum of four experts must be interviewed on each of the framework conditions).  


1. Finance  
2. Government policies  
3. Government programs  
4. Entrepreneurial Education and Training  
5. Research and Development Transfer (R & D)  
6. Commercial and professional infrastructure  
7. Internal Market openness  
8. Physical infrastructure and services  
9. Cultural and social norms  


The APS is a questionnaire distrubuted to a minimum of 2,000 adults in each participating country.  The survey is created by a central GEM team, but the implementation is managed by national teams that compete for the role of implementing the survey.  Experts are chosen based on experience and specialization and are expected to represent the entire country (including urban and rural areas).  

<br>

**Data Selection**  


After reviewing the available data, we decided to select the following variables for our analysis.  

Source | Indicator 
-------------|---------------
APS | Rate of Entrepreneurship (Intention, Nascent, Established)
NES | Way of Teaching
APS | Perceived Capabilities
APS | Fear of Failure / Perceived Opportunities
APS | Perceived Opportunities


The survey questions corresponding to these variables are as follows:

1. **Entrepreneurial Intention**: Percentage of 18-64 population (individuals involved in any stage of entrepreneurial activity excluded) who intend to start a business within three years.  


2. **Nascent Entrepreneurship**: Percentage of 18-64 population who are currently a nascent entrepreneur, i.e., actively involved in setting up a business they will own or co-own; this business has not paid salaries, wages, or any other payments to the owners for more than three months.  


3. **Established Entrepreneur**: Percentage of 18-64 population who are currently owner-manager of an established business, i.e., owning and managing a running business that has paid salaries, wages, or any other payments to the owners for more than 42 months.  


4. **Way of Teaching**: In my country, teaching in primary and secondary education encourages creativity, self-sufficiency, and personal initiative.  


5. **Perceived Capabilities**: Percentage of 18-64 population who believe to have the required skills and knowledge to start a business  


6. **Fear of Failure**: Percentage of 18-64 population with positive perceived opportunities who indicate that fear of failure would prevent them from setting up a business.  


7. **Perceived Opportunities**: Percentage of 18-64 population who see good opportunities to start a firm in the area where they live


The APS data represent the national-level average of values between 1 and 100 that were gathered as responses to surveys within each country.  The NES data is calculated based on the average answer to a survey to the national experts.  For each question, the experts surveyed had to state whether it is:    


1. Completely false
2. Somewhat false
3. Neither true or false
4. Somewhat true
5. Completely true

(97. Do not know)  
(98. Not applicable)  


The process of importing, cleaning, and analyzing all of the data used in this project is fully documented and reproducable by referencing our GitHub repository.


**Analytical Framework**  


To understand the impact of educational factors -- specifically the encouragement of creatitivity, self-sufficiency, and personal initiative  -- on the country-level rate of entrepreneurship we built our model as outlined in the table below.


Variable | Indicator 
-------------|---------------
Y Dependent Variable | Rate of Entrepreneurship (Intention, Nascent, Established)
X1 Explanatory Variable | Way of Teaching
X2 Control Variable | Perceived Capabilities
X3 Control Variable | Fear of Failure / Perceived Opportunities
X4 Control Variable | Perceived Opportunities  


..........(Describe why we use the rate of entrepreneurship indicators we chose)  


Data on our explanatory variable, Way of Teaching, is available on the GEM website for the years 2001-2010.  To illustrate the distribution of this data, we have created the following histogram.  As shown in the histogram, the largest density of scores is approximately 2.3, which lies between the "somewhat false" and "neither true or false" categories.  This is not a whole number because the scores given by each of the 4 experts surveyed for each frameork condition are averaged to create a national-level number.  As discussed later in this paper, this presents some difficulties in drawing substantive conclusions from this data.  Namely, a large number of indifferent responses complicate the process of determining the influence we would like to analyze.

```{r echo = FALSE, cache= FALSE, include= TRUE, results= 'asis', warning=FALSE}

# Create a histogram showing the distribution of Way of Teaching
qplot(WayofTeaching, data = wot, geom = "histogram", binwidth = .10)

```


In addition to understanding the density of each recorded "Way of Teaching" indicator, it is also helpful to examine the differences in this indicator among OECD countries.  To see this, we have created a figure showing the distribution of the average "Way of Teaching" value over the 2001-2010 period for the OECD countries included in the surveys.  This figure is included below.

```{r echo =FALSE, cache=FALSE, include=TRUE, results='asis', warning=FALSE, error=FALSE, message=FALSE}
# Import GEM data frame
WayofTeaching <- repmis::source_data("https://raw.githubusercontent.com/SamDund/Assign2Education/master/GEMData/WayofTeaching", header = TRUE, cache = FALSE, na.strings = "NA")

# Drop unnecessary column 1
WayofTeaching$X <- NULL

# Change data from long to wide format
WT <- reshape(WayofTeaching, idvar = c("iso2c", "Country"), timevar = "Year", direction = "wide")

# Delete variable name in Year columns
names(WT) <- gsub("WayofTeaching.", "", names(WT))

# Duplicate df for future use
WT2 <- WT

# Generate a new column with mean of all other columns
WT$mean <- rowMeans(subset(WT, select = c("2001", "2002", "2003", "2004", "2005", "2006", "2007", "2008",
                                          "2009", "2010")), na.rm = TRUE)

# Drop year columns, leaving only mean column
WT$'2001' <- NULL
WT$'2002' <- NULL
WT$'2003' <- NULL
WT$'2004' <- NULL
WT$'2005' <- NULL
WT$'2006' <- NULL
WT$'2007' <- NULL
WT$'2008' <- NULL
WT$'2009' <- NULL
WT$'2010' <- NULL
WT$'2011' <- NULL
WT$'2012' <- NULL
WT$'2013' <- NULL
WT$row.names <- NULL

# Create 
WT[, 3] <- round(log(WT[, 3]), digits = 2)
```

```{r echo = FALSE, cache= TRUE, include= TRUE, results= 'asis'}
library(googleVis)


# Plot
WT_map <- gvisGeoChart(WT, locationvar = 'iso2c',
                      colorvar = 'mean',
                      options = list(
                        colors = "['#ece7f2', '#2b8cbe']"
))
 
```



image: ![Way of Teaching](https://raw.githubusercontent.com/SamDund/Assign2Education/master/PresentationandPaper/images/WoTmap.png)








Starting with this explanatory variable, we built three regression equations to examine the impact of our explanatory variable on the rate of entrepreneurship (as measured by survey responses on the percentage of nascent entrepreneurs, established business owners, and respondents with the intention of becoming an entrepreneur).  These three regression equations are as follows:  


1. $PercentEntreIntention = \beta_1WayofTeaching  + \beta_2PerceivedCabability + \beta_3PerceivedOpportunities$   
  $+ \beta_4FearFailure + \beta_5FearFailure*PerceivedOpportunities$   


2. $PercentNascent = \beta_1WayofTeaching  + \beta_2PerceivedCabability + \beta_3PerceivedOpportunities$   
  $+ \beta_4FearFailure + \beta_5FearFailure*PerceivedOpportunities$  


3. $PercentOwner = \beta_1WayofTeaching  + \beta_2PerceivedCabability + \beta_3PerceivedOpportunities$   
  $+ \beta_4FearFailure + \beta_5FearFailure*PerceivedOpportunities$ 


The interaction term $\beta_5FearFailure*PerceivedOpportunities$ was added to the regression because the survey question regarding "Fear of Failure" was only proposed to survey respondents who indicated they do perceive opportunities to start a business.  



-------------------------



Based on a review of academic literature and expectations from other data analysis, we expected to see a statistically significant positive relationship between self-confidence reinforcement in teaching and the dependent variables we selected as indicators of the entrepreneurship rate.  Instead, we found that when controlling for country-specific effects, the Way of Teaching is not statistically significant when using "Nascent Entrepreur" or "Business Owner" as a dependent variable, has a negative coefficient in these regression equations.  This relationship can be seen in the following regression output table.  This regression output was generated using a simple least square regression model.

```{r echo = FALSE, cache= FALSE, include= FALSE}

# Library Zelig (can be buggy if loaded too early)
library(Zelig)

# Library Amelia for imputed data
library(Amelia)

# Import df of dependent and independent variables
CD <- repmis::source_data("https://raw.githubusercontent.com/SamDund/Assign2Education/master/GEMData/CompleteData.csv", header = TRUE, na.strings = "NA")


############ Running a regression with full df (including omitted variables)
RG1 <- lm(PercentIntention ~ WayofTeaching + PercentPerceived + PercentFear*PercentOpportunities + PercentOpportunities + Country, data = CD)

RG2 <- lm(PercentNascent ~ WayofTeaching + PercentPerceived + PercentFear*PercentOpportunities + PercentOpportunities + Country, data = CD)

RG3 <- lm(PercentOwner ~ WayofTeaching + PercentPerceived + PercentFear*PercentOpportunities + PercentOpportunities + Country, data = CD)
```

```{r echo = FALSE, cache= FALSE, include= TRUE, results= 'asis'}

# Create vector of lables
labels_1 <- c('Way of Teaching', 'Perceived Capabilities', 'Fear of Failure', 'Perceived Good Opportunities', 
             'Fear of Failure x Perceived Good Opportunities')

dlabels_1 <- c('Entrepreneurial Intention', 'Nascent Entrepreneur', 'Entrepreneurship Owner')


# Regression output table with country-specific effects
stargazer::stargazer(RG1, RG2, RG3,
                     title = 'Linear Regression Estimates with Country-specific Effects',
                     covariate.labels = labels_1, dep.var.labels = dlabels_1, digits = 2,
                     font.size =  "scriptsize", type = 'latex', no.space = TRUE)

```


To more clearly demonstrate the relationship between the "Way of Teaching" and our dependent variables, we have omitted the country-specific effects and generated simulations to show demonstrate the outcome of 1000 trials of our regression equation.  Before doing so, however, we ran another set of regressions to determine which equation we would like to examine more closely.  A regression output table with these results has been included below.

```{r echo = FALSE, cache= FALSE, include= FALSE, results= 'asis'}

# Run three regression equations again (omitting country-specific effects)
RG4 <- lm(PercentIntention ~ WayofTeaching + PercentPerceived + PercentFear*PercentOpportunities + PercentOpportunities, data = CD)

RG5 <- lm(PercentNascent ~ WayofTeaching + PercentPerceived + PercentFear*PercentOpportunities + PercentOpportunities, data = CD)

RG6 <- lm(PercentOwner ~ WayofTeaching + PercentPerceived + PercentFear*PercentOpportunities + PercentOpportunities, data = CD)

```

<br>
```{r echo = FALSE, cache= FALSE, include= TRUE, results= 'asis'}

# Regression output table with country-specific effects
stargazer::stargazer(RG4, RG5, RG6,
                     title = 'Linear Regression Estimates omitting Country-specific Effects',
                     covariate.labels = labels_1, dep.var.labels = dlabels_1, digits = 2,
                     font.size =  "scriptsize", type = 'latex', no.space = TRUE)

```


Given the positive relationship between the "Way of Teaching" and "Entrepreneurship Owner" we decided to use this equation for our simulations.   Given the prevelence of omitted data in our data frame, we decided to attempt to increase the accuracy of this model by using the R program Amelia to generate an imputed data frame.  This program uses statistical inference to generate imputed data (more information on the Amelia package can be found on the program's [CRAN page](http://cran.r-project.org/web/packages/Amelia/index.html)).  Equation  titled "Imputed" were calculated using this imputed data frame.


To generate the simulations, we decided to use the R package Zelig.  This package allows us to set parameters for an explanatory variable and simulate trials of the above equation (more information on the Zelig package can be found on the program's [CRAN page](http://cran.r-project.org/web/packages/Zelig/index.html).  We chose to simulate values in "Percent Perceived Capabilities" and "Way of Teaching" for this analysis.  A regression output table and our simulation results are included below.  Given our data characteristics and the available models in the Zelig package, we used a "Least Squares Regression for Continuous Dependent Variables."


```{r echo = FALSE, cache= FALSE, include= FALSE, results= 'asis'}

############ Running a regression omitting omitted variables

# Generate a df omitting omitted variables
CD_omitted <- na.omit(CD)

# Run a least squares regression with Zelig
Z1 <- zelig(PercentOwner ~ WayofTeaching + PercentPerceived + PercentFear*PercentOpportunities + PercentOpportunities, data = CD_omitted, model = "ls")


############ Runnig a Zelig regression with imputed data and omitting remaining omitted variables

# Import csv of df with imputed figures (created in Index_sources/Amelia_source)
CI <- repmis::source_data("https://raw.githubusercontent.com/SamDund/Assign2Education/gh-pages/GEMData/Cimputed5.csv", header = TRUE, sep = ",", na.strings = NA)

# Omit variables that could not be imputed by Adelia (b/c of lack of data)
CI_omitted <- na.omit(CI)

# Regression equation with imputed values
Z2 <- zelig(PercentOwner ~ WayofTeaching + PercentPerceived + PercentFear*PercentOpportunities + PercentOpportunities, data = CI_omitted, model = "ls")


############ Set range of values for Z1 and Z2 using imputed and not imputed dfs

####### Simulate Percent Perceived

# Set range of PercentPerceived values in simulation (NOT IMPUTED)
x.out1 <- setx(Z1, PercentPerceived = 9:67)

# Run simulation (default 1000 trials) (NOT IMPUTED)
simz1 <- sim(Z1, x = x.out1)

# Set range of PercentPerceived values in siumlation (IMPUTED)
x.out2 <- setx(Z2, PercentPerceived = 9:67)

# Run simulation (default 1000 trials) (IMPUTED)
simz2 <- sim(Z2, x = x.out2)


####### Simulate Way of Teaching

# Set range of WayofTeaching values in simulation (NOT IMPUTED)
x.out3 <- setx(Z1, WayofTeaching = 1.353:3.278)

# Run simulation (default 1000 trials) (NOT IMPUTED)
simz3 <- sim(Z1, x = x.out3)

# Set range of WayofTeaching values in simulation (IMPUTED)
x.out4 <- setx(Z2, WayofTeaching = 1.128:3.312)

# Run simulation (default 1000 trials) (IMPUTED)
simz4 <- sim(Z2, x = x.out4)

```

```{r echo = FALSE, cache= FALSE, include= TRUE, results= 'asis'}

# Set new vector for dependent variable label
dlabels_2 <- c('Entrepreneurship Owner')


# Regression output table with country-specific effects
stargazer::stargazer(Z1, Z2,
                     title = 'Linear Regression Estimates omitting Country-specific Effects',
                     covariate.labels = labels_1, dep.var.labels = dlabels_2, digits = 2,
                     font.size =  "small", type = 'latex', no.space = TRUE,
                     notes = "Regression equation 1 is unimputed, regression equation 2 is imputed")
```

```{r echo = FALSE, cache= FALSE, include= TRUE, results= 'asis'}
library("Zelig")

# Set layout
par(mfrow = c(2, 2))

# Plot simz1 (unimputed)
plot(simz1, xlab = 'Percent Perceived Opportunities', ylab = 'Percent Entrepreneurship Owner',
     main = "Unimputed (Equation 1)")

# Plot simz2 (imputed)
plot(simz2, xlab = 'Percent Perceived Opportunities', ylab = 'Percent Entrepreneurship Owner',
     main = "Imputed (Equation 2)")

# Plot simz3 (unimputed)
plot(simz3, xlab = 'Way of Teaching', ylab = 'Percent Entrepreneurship Owner',
     main = "Unimputed (Equation 1)")

# Plot simz4 (imputed)
plot(simz4, xlab = 'Way of Teaching', ylab = 'Percent Entrepreneurship Owner',
     main = "Imputed (Equation 2)")

```














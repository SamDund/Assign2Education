---
title: "Draft1"
author: "Sam"
date: "December 11, 2014"
output: pdf_document
---

```{r echo = FALSE, cache= FALSE, include= FALSE, results= 'asis'}

# Set working directory
setwd('~/Assign2Education/PresentationandPaper')

# Library required packages
library(ggvis)
library(devtools)
library(googleVis)
library(countrycode)
library(repmis)
library(reshape2)
library(shiny)
library(httpuv)
library(ggplot2)

# Create a vector of packages used
pkgs <- c('repmis', 'ggvis', 'devtools', 'googleVis', 'countrycode', 'reshape2', 'shiny', 'httpuv', 'Zelig',
          'stargazer', 'Amelia', 'ggplot2')

# Create citations txt file
repmis::LoadandCite(pkgs, file= 'RpackageCitations.bib')

# Import WayofTeaching data
wot <- repmis::source_data("https://raw.githubusercontent.com/SamDund/Assign2Education/master/GEMData/WayofTeaching", header = TRUE, cache = FALSE, na.strings = "NA")


```

**Quantitative Analysis of the Impact of Education on Entrepreneurship**     


*Data Sources*  


To complete a quantitative analysis of the impact of educational factors -- specifically the encouragement of creatitivity, self-sufficiency, and personal initiative  -- on the country-level rate of entrepreneurship, we have drawn on publicly available data from the Global Entrepreneurship Monitor (GEM) National Expert Survey (NES) and Adult Population Survey (APS).  


The Global Entrepreneurship Monitor project is an annual assessment of the entrepreneurial activity, aspirations, and attitudes of individuals across a wide range of countries.  The countries covered have grown from a low of ten to covering 75% of world population and 89% of world GDP by 2013.  The 2001-2010 multi-year APS data base, for example, contains over 1.3 million observations of a total of 85 countries.  This data is often cited in academic research, including reports by the Organisation for Economic Co-operation and Development.    


The NES is structured around nine entrepreneurial framework contitions evaluated by thirty-six experts in each surveyed country.  These nine entrepreneurial framework conditions are included below (a minimum of four experts must be interviewed on each of the framework conditions).  


1. Finance  
2. Government policies  
3. Government programs  
4. Entrepreneurial Education and Training  
5. Research and Development Transfer (R & D)  
6. Commercial and professional infrastructure  
7. Internal Market openness  
8. Physical infrastructure and services  
9. Cultural and social norms  


The APS is a questionnaire distrubuted to a minimum of 2,000 adults in each participating country.  The survey is created by a central GEM team, but the implementation is managed by national teams that compete for the role of implementing the survey.  Experts are chosen based on experience and specialization and are expected to represent the entire country (including urban and rural areas).  

<br>

**Data Selection**  


After reviewing the available data, we decided to select the following variables for our analysis.  

Source | Indicator 
-------------|---------------
APS | Rate of Entrepreneurship (Intention, Nascent, Established)
NES | Way of Teaching
APS | Perceived Capabilities
APS | Fear of Failure / Perceived Opportunities
APS | Perceived Opportunities


The survey questions corresponding to these variables are as follows:

1. **Entrepreneurial Intention**: Percentage of 18-64 population (individuals involved in any stage of entrepreneurial activity excluded) who intend to start a business within three years.  


2. **Nascent Entrepreneurship**: Percentage of 18-64 population who are currently a nascent entrepreneur, i.e., actively involved in setting up a business they will own or co-own; this business has not paid salaries, wages, or any other payments to the owners for more than three months.  


3. **Established Entrepreneur**: Percentage of 18-64 population who are currently owner-manager of an established business, i.e., owning and managing a running business that has paid salaries, wages, or any other payments to the owners for more than 42 months.  


4. **Way of Teaching**: In my country, teaching in primary and secondary education encourages creativity, self-sufficiency, and personal initiative.  


5. **Perceived Capabilities**: Percentage of 18-64 population who believe to have the required skills and knowledge to start a business  


6. **Fear of Failure**: Percentage of 18-64 population with positive perceived opportunities who indicate that fear of failure would prevent them from setting up a business.  


7. **Perceived Opportunities**: Percentage of 18-64 population who see good opportunities to start a firm in the area where they live


The APS data represent the national-level average of values between 1 and 100 that were gathered as responses to surveys within each country.  The NES data is calculated based on the average answer to a survey to the national experts.  For each question, the experts surveyed had to state whether it is:    


1. Completely false
2. Somewhat false
3. Neither true or false
4. Somewhat true
5. Completely true

(97. Do not know)  
(98. Not applicable)  


The process of importing, cleaning, and analyzing all of the data used in this project is fully documented and reproducable by referencing our GitHub repository.


**Analytical Framework**  


To understand the impact of educational factors -- specifically the encouragement of creatitivity, self-sufficiency, and personal initiative  -- on the country-level rate of entrepreneurship we built our model as outlined in the table below.


Variable | Indicator 
-------------|---------------
Y Dependent Variable | Rate of Entrepreneurship (Intention, Nascent, Established)
X1 Explanatory Variable | Way of Teaching
X2 Control Variable | Perceived Capabilities
X3 Control Variable | Fear of Failure / Perceived Opportunities
X4 Control Variable | Perceived Opportunities  


..........(Describe why we use the rate of entrepreneurship indicators we chose)  


Data on our explanatory variable, Way of Teaching, is available on the GEM website for the years 2001-2010.  To illustrate the distribution of this data, we have created the following histogram.  As shown in the histogram, the largest density of scores is approximately 2.3, which lies between the "somewhat false" and "neither true or false" categories.  This is not a whole number because the scores given by each of the 4 experts surveyed for each frameork condition are averaged to create a national-level number.  As discussed later in this paper, this presents some difficulties in drawing substantive conclusions from this data.  Namely, a large number of indifferent responses complicate the process of determining the influence we would like to analyze.

```{r echo = FALSE, cache= FALSE, include= TRUE, results= 'asis', warning=FALSE}

# Create a histogram showing the distribution of Way of Teaching
qplot(WayofTeaching, data = wot, geom = "histogram", binwidth = .10)

```


Starting with this explanatory variable, we built three regression equations to examine the impact of our explanatory variable on the rate of entrepreneurship (as measured by survey responses on the percentage of nascent entrepreneurs, established business owners, and respondents with the intention of becoming an entrepreneur).  These three regression equations are as follows:  


1. $PercentEntreIntention = \beta_1WayofTeaching  + \beta_2PerceivedCabability + \beta_3PerceivedOpportunities$   
  $+ \beta_4FearFailure + \beta_5FearFailure*PerceivedOpportunities$   


2. $PercentNascent = \beta_1WayofTeaching  + \beta_2PerceivedCabability + \beta_3PerceivedOpportunities$   
  $+ \beta_4FearFailure + \beta_5FearFailure*PerceivedOpportunities$  


3. $PercentOwner = \beta_1WayofTeaching  + \beta_2PerceivedCabability + \beta_3PerceivedOpportunities$   
  $+ \beta_4FearFailure + \beta_5FearFailure*PerceivedOpportunities$ 


The interaction term $\beta_5FearFailure*PerceivedOpportunities$ was added to the regression because the survey question regarding "Fear of Failure" was only proposed to survey respondents who indicated they do perceive opportunities to start a business.  


(Take this for the paper)

Based on a review of academic literature and expectations from other data analysis, we expected to see a statistically significant positive relationship between self-confidence reinforcement in teaching and the  dependent variables we selected as indicators of the entrepreneurship rate.  Instead, we found that when controlling for country-specific effects, the Way of Teaching is not statistically significant and has a negative relationship with our explanatory variables.  


Overall, however, if we omit country-specific effects, we can demonstrate that the Way of Teaching and the Percent Perceived Good Opportunities are statistically significant in the model indicated below.  

<br>

$NationalLevelAveragePercentOwningaBusiness = -6.82 + 1.03WayofTeaching + 0.10Percent Perceived Capability +$  
$0.21Percent Fear Failure$ $+$ $0.12Percent Perceived Opportunities - 0.005Percent Fear Failure$ $*$ $Percent Perceived Opportunities$  

<br>

We can show the relationship between the dependent and explanatory variables in the four simulations below.  The R package Zelig allows us to set parameters for an explanatory variable and simulate 1000 trials of the above equation (more information on the Zelig package can be found on the program's [CRAN page](http://cran.r-project.org/web/packages/Zelig/index.html).  We chose to simulate values in "Percent Perceived Capabilities" and "Way of Teaching" for this analysis.  A regression output table has also been included below.


The simulations labeled "Unimputed" were created using only data collected from GEM. This simulation is not possible with missing data, so observations with missing data were omitted.  In an attempt to increase the accuracy of this model, we used the R program Amelia to generate an imputed data frame.  This program uses statistical inference to generate this data (more information on the Amelia package can be found on the program's [CRAN page](http://cran.r-project.org/web/packages/Amelia/index.html)).  Simulations titled "Imputed" were calculated using this imputed data frame.

```{r echo = FALSE, cache= FALSE, include= FALSE}

# Library Zelig (can be buggy if loaded too early)
library(Zelig)

# Library Amelia for imputed data
library(Amelia)

# Import df of dependent and independent variables
CD <- repmis::source_data("https://raw.githubusercontent.com/SamDund/Assign2Education/master/GEMData/CompleteData.csv", header = TRUE, na.strings = "NA")


############ Running a regression with full df (including omitted variables)
RG1 <- lm(PercentOwner ~ WayofTeaching + PercentPerceived + PercentFear*PercentOpportunities + PercentOpportunities, data = CD)

RG2 <- lm(PercentOwner ~ WayofTeaching + PercentPerceived + PercentFear*PercentOpportunities + PercentOpportunities + Country, data = CD)

############ Running a regression omitting omitted variables

# Generate a df omitting omitted variables
CD_omitted <- na.omit(CD)

# Run a least squares regression with Zelig
Z1 <- zelig(PercentOwner ~ WayofTeaching + PercentPerceived + PercentFear*PercentOpportunities + PercentOpportunities, data = CD_omitted, model = "ls")


############ Runnig a Zelig regression with imputed data and omitting remaining omitted variables

# Import csv of df with imputed figures (created in Index_sources/Amelia_source)
CI <- repmis::source_data("https://raw.githubusercontent.com/SamDund/Assign2Education/gh-pages/GEMData/Cimputed5.csv", header = TRUE, sep = ",", na.strings = NA)

# Omit variables that could not be imputed by Adelia (b/c of lack of data)
CI_omitted <- na.omit(CI)

# Regression equation with imputed values
Z2 <- zelig(PercentOwner ~ WayofTeaching + PercentPerceived + PercentFear*PercentOpportunities + PercentOpportunities, data = CI_omitted, model = "ls")


############ Set range of values for Z1 and Z2 using imputed and not imputed dfs

####### Simulate Percent Perceived

# Set range of PercentPerceived values in simulation (NOT IMPUTED)
x.out1 <- setx(Z1, PercentPerceived = 9:67)

# Run simulation (default 1000 trials) (NOT IMPUTED)
simz1 <- sim(Z1, x = x.out1)

# Set range of PercentPerceived values in siumlation (IMPUTED)
x.out2 <- setx(Z2, PercentPerceived = 9:67)

# Run simulation (default 1000 trials) (IMPUTED)
simz2 <- sim(Z2, x = x.out2)


####### Simulate Way of Teaching

# Set range of WayofTeaching values in simulation (NOT IMPUTED)
x.out3 <- setx(Z1, WayofTeaching = 1.353:3.278)

# Run simulation (default 1000 trials) (NOT IMPUTED)
simz3 <- sim(Z1, x = x.out3)

# Set range of WayofTeaching values in simulation (IMPUTED)
x.out4 <- setx(Z2, WayofTeaching = 1.128:3.312)

# Run simulation (default 1000 trials) (IMPUTED)
simz4 <- sim(Z2, x = x.out4)

```



```{r echo = FALSE, cache= FALSE, include= TRUE, results= 'asis'}
library("Zelig")

# Set layout
par(mfrow = c(2, 2))

# Plot simz1 (unimputed)
plot(simz1, xlab = 'Percent Perceived Opportunities', ylab = 'Percent Entrepreneurship Owner',
     main = "Unimputed (Equation 1)")

# Plot simz2 (imputed)
plot(simz2, xlab = 'Percent Perceived Opportunities', ylab = 'Percent Entrepreneurship Owner',
     main = "Imputed (Equation 2)")

# Plot simz3 (unimputed)
plot(simz3, xlab = 'Way of Teaching', ylab = 'Percent Entrepreneurship Owner',
     main = "Unimputed (Equation 1)")

# Plot simz4 (imputed)
plot(simz4, xlab = 'Way of Teaching', ylab = 'Percent Entrepreneurship Owner',
     main = "Imputed (Equation 2)")

```

```{r echo = FALSE, cache= FALSE, include= FALSE, results= 'asis'}
library(stargazer)

# Create regression output table
labels <- c('Way of Teaching', 'National Level Perceived Capabilities', 'National Level Avg Fear of Failure',
            'National Level Avg Perceived Good Opportunities', 
            'National Level Avg Fear of Failure x National Level Avg Perceived Good Opportunities',
            '(Intercept)')

dlabels <- c('National Level Average Percent Owning a Business')

```

<br>

```{r echo = FALSE, cache= FALSE, include= TRUE, results= 'asis'}

stargazer::stargazer(Z1, Z2, covariate.labels = labels, dep.var.labels = dlabels,
                     title = 'Linear Regression Estimates', notes = "Regression equation 1 is unimputed, regression equation 2 is imputed", digits = 2, type = 'latex')


```









```{r echo =FALSE, cache=TRUE, include=FALSE, results='asis', warning=FALSE}

# Import df of dependent and independent variables
CD <- repmis::source_data("https://raw.githubusercontent.com/SamDund/Assign2Education/master/GEMData/CompleteData.csv", header = TRUE, na.strings = "NA")


# Run linear regression R1
R1 <- lm(PercentIntention ~ WayofTeaching + PercentPerceived + PercentFear + PercentOpportunities + PercentFear*PercentOpportunities + Country, data = CD)


# Run linear regression R2
R2 <- lm(PercentNascent ~ WayofTeaching + PercentPerceived + PercentFear + PercentOpportunities + PercentFear*PercentOpportunities + Country, data = CD)


# Run linear regression R3
R3 <- lm(PercentOwner ~ WayofTeaching + PercentPerceived + PercentFear + PercentOpportunities + PercentFear*PercentOpportunities + Country, data = CD)

 
```

```{r echo = FALSE, cache=TRUE, include=TRUE, results='asis', warning=FALSE} 

# Library Stargazer for regression output tables
library(stargazer)

# Create regression output table
labels <- c('National Level Avg Perceived Capabilities', 'National Level Avg Fear of Failure',
            'Annual GDP Growth', 'National Level Avg Perceived Good Opportunities', 'National Level Avg Fear of Failure x National Level Avg Perceived Good Opportunities','(Intercept)')

dlables <- c('National Level Average Percent Entrepreneurial Intention', 'National Level Nascent Entrepreneural Activity', 'National Level Average Percent Owning a Business')

stargazer::stargazer(R1, R2, R3, covariate.labels = labels, dep.var.labels = dlables,
                     title = 'Linear Regression Estimates', digits = 2, type = 'html')


